project:
  name: rust-hello-world-small-production

services:
  # Production app with horizontal scaling for moderate traffic.
  # minContainers: 2 ensures two containers are always running — zero-downtime deployments
  # work by starting new containers before removing old ones from the project balancer,
  # and two containers give the balancer failover capacity during that transition.
  - hostname: app
    type: rust@stable
    zeropsSetup: prod
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 2
    verticalAutoscaling:
      minRam: 0.125
      # Rust has no GC, so memory usage is predictable. Reserve ~40% as headroom
      # for the async Tokio runtime and concurrent connections under traffic spikes.
      minFreeRamGB: 0.05

  # Deploy PostgreSQL database for app data.
  # Priority 10 ensures the database starts before app containers — without this,
  # the app would fail with "connection refused" during deployment.
  # This startup ordering pattern applies to all data services in this project.
  - hostname: db
    type: postgresql@17
    mode: NON_HA
    priority: 10
