project:
  name: rust-hello-world-small-production

services:
  # Production app: two containers run at all times (minContainers: 2) so
  # deploys are zero-downtime â€” new containers become healthy before old ones
  # are removed from the project balancer. Rust binaries use very little RAM
  # (no GC, no JVM), but we reserve minFreeRamGB for traffic spikes and OS
  # memory allocation overhead.
  - hostname: app
    type: rust@stable
    zeropsSetup: prod
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 2
    maxContainers: 6
    resources:
      minRam: 0.125
      # Reserve ~30% of minRam as free headroom. Rust has no GC pauses, but
      # concurrent requests and OS memory fragmentation still need breathing
      # room to avoid OOM kills.
      minFreeRamGB: 0.05
      minVCpu: 1

  # Deploy PostgreSQL database for app data.
  # Priority 10 ensures the database starts before app containers, preventing
  # connection errors during deployment.
  - hostname: db
    type: postgresql@17
    mode: NON_HA
    priority: 10
