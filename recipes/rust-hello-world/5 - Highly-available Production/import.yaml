project:
  name: rust-hello-world-highly-available-production
  # SERIOUS core: dedicated project infrastructure with isolated routing and enhanced
  # performance. The default Lightweight core is shared across projects; SERIOUS provides
  # dedicated balancer capacity for consistent latency at scale.
  corePackage: SERIOUS

services:
  # HA production app with dedicated CPU and aggressive scaling floor.
  # cpuMode: DEDICATED eliminates scheduler contention — Rust's zero-cost abstractions
  # and async I/O deliver maximum throughput when the CPU is not shared with other workloads.
  # minContainers: 2 ensures zero-downtime deployments and load balancer failover capacity.
  - hostname: app
    type: rust@stable
    zeropsSetup: prod
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 2
    verticalAutoscaling:
      minRam: 0.25
      # Reserve ~40% RAM for the async runtime, OS page cache, and request bursts.
      minFreeRamGB: 0.1
      cpuMode: DEDICATED

  # Deploy PostgreSQL database with HA mode for production durability.
  # HA mode runs two database containers with synchronous replication — if one fails,
  # the other takes over without data loss or manual intervention.
  # Priority 10 ensures the database starts before app containers (startup ordering
  # pattern explained at 'app' service above — applies to all data services).
  - hostname: db
    type: postgresql@17
    mode: HA
    priority: 10
    verticalAutoscaling:
      cpuMode: DEDICATED
      minRam: 1
