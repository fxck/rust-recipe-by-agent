project:
  name: rust-hello-world-ai-agent

services:
  # Development container where an AI agent (Claude Code, opencode, etc.) writes and
  # iterates on application code. The agent SSHs in, edits source files, runs 'cargo run'
  # to test locally, and uses 'zcli push' to deploy builds to appstage for pipeline validation.
  - hostname: appdev
    type: rust@stable
    zeropsSetup: dev
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 1
    verticalAutoscaling:
      # 0.5 GB floor gives cargo enough RAM for initial compilation — the first
      # 'cargo run' compiles the full dependency tree and spikes memory noticeably.
      minRam: 0.5

  # Staging container for validating the production build pipeline.
  # After iterating in appdev, the agent runs 'zcli push <appstage-id> --setup=prod'
  # to confirm the release binary builds, deploys, and passes the readiness check.
  - hostname: appstage
    type: rust@stable
    zeropsSetup: prod
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 1

  # Deploy PostgreSQL database for app data.
  # Priority 10 ensures the database starts before app containers — without this,
  # both appdev and appstage would attempt to connect before the database is ready
  # and fail with "connection refused". This startup ordering pattern applies to
  # all data services in this project.
  - hostname: db
    type: postgresql@17
    mode: NON_HA
    priority: 10
