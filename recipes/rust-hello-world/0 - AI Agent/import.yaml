project:
  name: rust-hello-world-ai-agent

services:
  # Development container for the AI agent to write and test code via SSH.
  # Receives 'dev' setup deployments: full source code + pre-fetched crate
  # registry, ready for 'cargo run' without any additional setup.
  # The subdomain gives the agent an HTTP endpoint to verify changes quickly.
  - hostname: appdev
    type: rust@stable
    zeropsSetup: dev
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 1
    maxContainers: 1
    resources:
      minRam: 0.5
      minVCpu: 1

  # Staging container for the AI agent to validate the production build
  # pipeline: push source → build container compiles the release binary →
  # binary deploys here → readiness check confirms the app is healthy.
  # Mirrors what a real production deploy does, at minimal resource cost.
  - hostname: appstage
    type: rust@stable
    zeropsSetup: prod
    buildFromGit: https://github.com/zerops-recipe-apps/rust-hello-world-app
    enableSubdomainAccess: true
    minContainers: 1
    maxContainers: 1
    resources:
      minRam: 0.125
      minFreeRamGB: 0.05

  # Deploy PostgreSQL database for app data.
  # Priority 10 ensures the database starts before app containers, preventing
  # connection errors during deployment. This startup ordering pattern applies
  # to all data services in this project.
  - hostname: db
    type: postgresql@17
    mode: NON_HA
    priority: 10
